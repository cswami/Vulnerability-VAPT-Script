Dyu=`cat /etc/trueuserdomains |awk -F : {'print $1'}|grep -ow $1 2>&1`
if [ -z "$1" ] || [ -z "$Dyu" ]

then

echo -e -n "\e[1;31m \t \t \t Incorrect domain name \e[0m "


else

echo "abuse script"
DOMAIN="$1"

USER=$(/scripts/whoowns $DOMAIN)


DOCROOT=$(httpd -V | grep HTTPD_ROOT | cut -d"=" -f2 | cut -d'"' -f2)


CDOCROOT=$(grep -C 3 www.$DOMAIN  $DOCROOT/conf/httpd.conf | grep DocumentRoot | sort -n | uniq | awk {'print $2'})
echo "$CDOCROOT"

cd $CDOCROOT ; echo "<?php phpinfo(); ?>"  > phpinfo.php
chown $USER.$USER phpinfo.php
echo -e "PHP Version : `php phpinfo.php | grep "PHP Version"|sort -n | uniq | awk {'print $4'}`"
      if [ -e "$CDOCROOT/wp-config.php" ]; then
echo -e " Wordpress `grep wp_version $CDOCROOT/wp-includes/version.php | cut -d"'" -f2 | grep [0-9]|  tr "\n" " "`"
fi
if [ -e "$CDOCROOT/libraries/joomla/version.php" ]; then
echo -e " Application Hosted \t\t:-\t\t\t    Joomla  `fgrep '$RELEASE'  $CDOCROOT/libraries/joomla/version.php | cut -d"'" -f2|  tr "\n" " "`"

               fi
if [ -e "$CDOCROOT/modules/system/system.info" ];then
echo -e " Application Hosted \t\t:-\t\t\t    Drupal `cat $CDOCROOT/modules/system/system.info  | grep version | cut -d'"' -f2 | grep [0-9]|  tr "\n" " "` "
                      fi

echo "========================================================================="
echo "upload files"
find $CDOCROOT -type f -name "*.php" -o -name "*.png" -o -name "*.js" | grep "upload/"

echo "========================================================================="
echo "files changed in laste 7 days "
find $CDOCROOT -type f -ctime -7 -ls
echo "========================================================================="
echo -e "PHP Version : `php phpinfo.php | grep "PHP Version"|sort -n | uniq | awk {'print $4'}`"

echo -e "==========================================="

echo -e "Loaded Configuration File :- \t `php  phpinfo.php | grep "Loaded Configuration File" |awk {'print $5'}` "

echo -e "==========================================="
echo -e " disable_functions should be disabled"

php  phpinfo.php| grep "disable_functions"
echo -e "==========================================="
echo -e " expose_php should be off"
php  phpinfo.php| grep "expose_php"
echo -e "==========================================="
find $CDOCROOT -type f \( -name "*.sql" -o -name "*.zip" -o -name "*.tar" -o -name "*.tar.gz" -o -name "*.tar.bz2" -o -name "*.gz" \)

echo -e "==========================================="
if [ -d "/etc/apache2" ]

then

cat /var/log/apache2/domlogs/$DOMAIN | cut -d\" -f2 | awk '{print $1 " " $2}' | sort | uniq -c | sort -n



cat /var/log/apache2/domlogs/$DOMAIN | cut -d\- -f 1 | sort | uniq -c | sort -n

else

cat /usr/local/apache/domlogs/$DOMAIN | cut -d\" -f2 | awk '{print $1 " " $2}' | sort | uniq -c | sort -n

cat /usr/local/apache/domlogs/$DOMAIN | cut -d\- -f 1 | sort | uniq -c | sort -n
fi
echo "====================================="
echo "base code64"
grep -lr --include=*.php "eval(base64_decode" $CDOCROOT

find $CDOCROOT -type d -perm 0777
fi
